<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <title>Web Design Studio</title>
    <!--CC BY 4.0 Niels F. Garmann-Johnsen (https://creativecommons.org/licenses/by/4.0/)-->
    <link rel="stylesheet" href="./css/StudioStyle.css">
    <link rel="icon" href="./img/designIT_logo.png">
</head>

<body>
    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="nav-brand">
            <img src="./img/designIT_logo.png" alt="DesignIT Logo" class="nav-logo">
            <span class="brand-text">DesignIT - Web Design Studio</span>
        </div>
        <div class="nav-links">
            <button id="undo">Undo</button>
            <button id="clear">Clear</button>
            <button id="export">Export</button>
        </div>
    </nav>

    <div class="container">
        <div class="menu">
            <h3>Elements</h3>
        </div>

        <div class="resizer" id="resizer1"></div>

        <div class="canvas" id="canvas">
            <h3>Canvas</h3>
        </div>

        <div class="resizer" id="resizer2"></div>

        <div class="side-panel">
            <div class="tab-container">
                <button class="copy-btn" id="copyBtn" onclick="copyTabContent()" title="Copy content">ðŸ“‹</button>
                <div class="tab" onclick="openTab(event, 'tab1')">HTML</div>
                <div class="tab" onclick="openTab(event, 'tab2')">CSS</div>
                <div class="tab" onclick="openTab(event, 'tab3')">Ref.</div>
            </div>

            <div id="tab1" class="tab-content">
                <pre></pre>
            </div>

            <div id="tab2" class="tab-content">
                <pre></pre>
            </div>

            <div id="tab3" class="tab-content">
                <p></p>
            </div>
        </div>
    </div>

    <script src="./js/StudioScriptTwo.js"></script>
    <script>
        // Function to open a specific tab
        function openTab(evt, tabName) {
            // Hide all tab content
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Remove the active class from all tabs
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active-tab", " ");
            }

            // Show the current tab content and mark the clicked tab as active
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active-tab";

            // Update copy button text based on active tab
            updateCopyButtonText(tabName);
        }

        // Function to update copy button text based on active tab
        function updateCopyButtonText(tabName) {
            const copyBtn = document.getElementById('copyBtn');

            switch (tabName) {
                case 'tab1':
                    copyBtn.textContent = 'ðŸ“‹';
                    copyBtn.title = 'Copy HTML';
                    break;
                case 'tab2':
                    copyBtn.textContent = 'ðŸ“‹';
                    copyBtn.title = 'Copy CSS';
                    break;
                default:
                    copyBtn.textContent = 'ðŸ“‹';
                    copyBtn.title = 'Copy content';
            }
        }

        // Function to copy the currently active tab content
        function copyTabContent() {
            const activeTab = document.querySelector('.tab-content.active, .tab-content[style*="block"]');
            const copyBtn = document.getElementById('copyBtn');

            if (!activeTab) return;

            // Don't allow copying from the reference tab
            if (activeTab.id === 'tab3') {
                copyBtn.textContent = 'ðŸš«';
                copyBtn.title = 'References cannot be copied';
                setTimeout(() => {
                    updateCopyButtonText('tab3');
                }, 1500);
                return;
            }

            let textToCopy = '';

            // Get text content based on the element type
            const preElement = activeTab.querySelector('pre');
            const pElement = activeTab.querySelector('p');

            if (preElement) {
                // Get only text nodes, excluding separator elements
                let textContent = '';
                for (let node of preElement.childNodes) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        textContent += node.textContent;
                    }
                }
                textToCopy = textContent;
            } else if (pElement) {
                textToCopy = pElement.textContent || pElement.innerText;
            }

            if (textToCopy.trim() === '') {
                // No content to copy - do nothing (no visual feedback)
                return;
            }

            // Use the Clipboard API if available, fallback to older method
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopySuccess(copyBtn, activeTab.id);
                }).catch(err => {
                    fallbackCopy(textToCopy, copyBtn, activeTab.id);
                });
            } else {
                fallbackCopy(textToCopy, copyBtn, activeTab.id);
            }
        }

        // Fallback copy method for older browsers
        function fallbackCopy(text, button, tabId) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopySuccess(button, tabId);
            } catch (err) {
                console.error('Failed to copy: ', err);
                button.textContent = 'âŒ';
                button.title = 'Copy failed';

                // Show error notification
                showNotification('Copy failed!', 'error');

                setTimeout(() => {
                    updateCopyButtonText(tabId);
                }, 1500);
            }

            document.body.removeChild(textArea);
        }

        // Show copy success feedback
        function showCopySuccess(button, tabId) {
            button.textContent = 'âœ…';
            button.classList.add('copied');

            const tabType = tabId === 'tab1' ? 'HTML' : 'CSS';
            button.title = `${tabType} copied!`;

            // Show notification
            showNotification(`${tabType} copied!`, 'success');

            setTimeout(() => {
                button.classList.remove('copied');
                updateCopyButtonText(tabId);
            }, 1500);
        }

        // Function to show notifications
        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.copy-notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create new notification
            const notification = document.createElement('div');
            notification.className = `copy-notification ${type}`;
            notification.textContent = message;

            // Add to body
            document.body.appendChild(notification);

            // Trigger animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Remove after delay
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 2000);
        }

        // Open the first tab by default
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelector('.tab').click();
            // Initialize copy button text for the default tab (HTML)
            updateCopyButtonText('tab1');
        });

        // Resizer functionality
        function initResizers() {
            const resizer1 = document.getElementById('resizer1');
            const resizer2 = document.getElementById('resizer2');
            const menu = document.querySelector('.menu');
            const canvas = document.querySelector('.canvas');
            const sidePanel = document.querySelector('.side-panel');
            const container = document.querySelector('.container');

            let isResizing = false;
            let currentResizer = null;

            function startResize(e, resizer) {
                isResizing = true;
                currentResizer = resizer;
                resizer.classList.add('active');
                document.body.style.cursor = 'col-resize';
                e.preventDefault();
            }

            function doResize(e) {
                if (!isResizing) return;

                const containerRect = container.getBoundingClientRect();
                const mouseX = e.clientX - containerRect.left;
                const containerWidth = containerRect.width;

                if (currentResizer === resizer1) {
                    // Resize menu panel
                    const newMenuWidth = (mouseX / containerWidth) * 100;
                    if (newMenuWidth >= 10 && newMenuWidth <= 50) {
                        menu.style.flex = `0 0 ${newMenuWidth}%`;
                    }
                } else if (currentResizer === resizer2) {
                    // Resize side panel
                    const newSidePanelWidth = ((containerWidth - mouseX) / containerWidth) * 100;
                    if (newSidePanelWidth >= 15 && newSidePanelWidth <= 60) {
                        sidePanel.style.flex = `0 0 ${newSidePanelWidth}%`;
                    }
                }
            }

            function stopResize() {
                if (isResizing) {
                    isResizing = false;
                    if (currentResizer) {
                        currentResizer.classList.remove('active');
                    }
                    currentResizer = null;
                    document.body.style.cursor = '';
                }
            }

            // Event listeners
            resizer1.addEventListener('mousedown', (e) => startResize(e, resizer1));
            resizer2.addEventListener('mousedown', (e) => startResize(e, resizer2));
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
        }

        // Initialize resizers when DOM is loaded
        document.addEventListener('DOMContentLoaded', initResizers);
    </script>
</body>

</html>